---
icon: windows
---

# Hunting and Exploiting Vulnerable Windows Drivers

#### Introduction

When it comes to **privilege escalation** on Windows systems, vulnerable kernel-mode drivers are a gold mine for attackers. These drivers, often loaded with administrative privileges, can be abused to **read/write kernel memory**, **escalate privileges**, or even **bypass security tools**.

This post will walk you through how to **find vulnerable drivers**, **analyze them**, and **exploit them** — all within a **controlled and ethical lab environment**.

***

### What Makes Drivers Dangerous?

Windows kernel drivers operate with high-level privileges. When poorly written drivers expose dangerous **IOCTL handlers** or allow arbitrary memory access, they become perfect targets for attackers.

***

### Part 1: Finding Vulnerable Drivers on a Windows System

#### Step 1: Enumerate Installed Drivers

Use PowerShell or built-in tools to list installed and loaded drivers:

```
Get-WmiObject Win32_SystemDriver | Select-Object Name, PathName, StartMode, State
```

Or via CMD:

```
driverquery /V /FO CSV > drivers.csv
```

#### Step 2: Identify Known Vulnerable Drivers

Once you have the list:

* Extract the driver name and version
* Cross-reference them on:
  * https://www.cvedetails.com/
  * https://www.exploit-db.com/
  * [https://github.com/SecWiki/windows-kernel-exploits](https://github.com/SecWiki/windows-kernel-exploits)

**Automation Tip:** Use tools like:

* `WinDriverView`
* Custom PowerShell scripts
* GitHub tools like `VulnDriverScanner`

***

### Part 2: Downgrading to a Vulnerable Driver

Often, you’ll need to **forcefully install an old driver version** that’s known to be vulnerable.

#### Preparation (Lab Only!)

* Use a **VM** (VirtualBox/VMware)
* Disable **Driver Signature Enforcement**:

```
bcdedit /set testsigning on
bcdedit /set nointegritychecks on
```

> Reboot after making the change.

Also disable **HVCI/Memory Integrity** from Windows Security > Core Isolation.

#### Step-by-Step Downgrade Process

**1. Remove the Existing Driver**

```
pnputil /delete-driver oemXX.inf /uninstall /force
```

Or via Device Manager: Uninstall and check "Delete driver software".

**2. Install Vulnerable Version**

Use a loader like:

* OSR Driver Loader
* Manual install via SC:

```
sc create vulnDrv binPath= C:\path\vuln.sys type= kernel start= demand
sc start vulnDrv
```

Or map it manually using tools like `kdmapper`.

**3. Verify It's Loaded**

```
Get-WmiObject Win32_SystemDriver | Where-Object { $_.Name -eq "vulnDrv" }
```

***

### Part 3: Analyzing and Exploiting the Driver

#### Step 1: Identify IOCTL Codes

Use tools like:

* Process Monitor
* WinObj
* ioctl-fuzzer

Look for unprotected or poorly validated `DeviceIoControl()` calls.

#### Step 2: Write Exploit

Use `DeviceIoControl()` in C/C++ or Python to send malicious IOCTLs.

A basic C++ snippet:

```
HANDLE hDevice = CreateFile(L"\\\\.\\VulnDevice", ...);
DWORD bytesReturned;
DeviceIoControl(hDevice, IOCTL_VULN_CODE, inBuf, inSize, outBuf, outSize, &bytesReturned, NULL);
```

#### Real Exploits Examples

| Driver                         | CVE            | Exploit                                   |
| ------------------------------ | -------------- | ----------------------------------------- |
| Capcom.sys                     | CVE-2016-1531  | https://github.com/KaLendsi/CVE-2016-1531 |
| RTCore64.sys (MSI)             | CVE-2019-16098 | Kernel R/W, LPE                           |
| HackSysExtremeVulnerableDriver | -              | Training driver with multiple PoCs        |

***

### Cleanup

When you're done:

```
sc stop vulnDrv
sc delete vulnDrv
bcdedit /set testsigning off
bcdedit /set nointegritychecks off
```

***

### Pro Tips for Red Teamers

* Always use VMs with snapshots
* Use WinDbg, Ghidra, or IDA Pro to reverse IOCTL handlers
* Automate exploit testing via custom fuzzers
* Load unsigned drivers via `kdmapper`
* Document everything — from IOCTL codes to crash behavior

***

### Further Reading

* [SecWiki Windows Kernel Exploits](https://github.com/SecWiki/windows-kernel-exploits)
* [HackSys Extreme Vulnerable Driver](https://github.com/hacksysteam/HackSysExtremeVulnerableDriver)
* [Windows Internals - Microsoft](https://docs.microsoft.com/en-us/sysinternals/)
* Capcom.sys Local PrivEsc

***

### Conclusion

Vulnerable drivers are a powerful, often overlooked attack surface. When properly understood, they provide deep insights into **Windows internals** and **real-world privilege escalation** scenarios. Mastering them will up your game in red teaming, CTFs, and exploit dev.

Stay safe. Test smart. Hack ethically.



***

## REFERENCES

* [https://github.com/FourCoreLabs/LolDriverScan](https://github.com/FourCoreLabs/LolDriverScan)

